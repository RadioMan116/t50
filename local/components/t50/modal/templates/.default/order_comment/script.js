!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){t.exports=preact},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),o=n(2);$(document).ready(function(){r.render(r.h(o.default,null),document.getElementById("order_comment_react"))})},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),i=n(3),c=n(4),l=n(5),u=n(7),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={remind:!1,remind_date:null,remind_time:null,themes:window.themes,theme:null,forReclamation:!1},e.formPersonsData={comment:"",targetManagers:[]},e}return o(e,t),e.prototype.componentDidMount=function(){var t=this;$(".modal[id='order_comment']").on("modal_loaded",function(e,n){var r=n.$orig.data();t.setState({forReclamation:"Y"==r.reclamation})})},e.prototype.componentDidUpdate=function(){$(this.base).find(".js-select:visible").select2({minimumResultsForSearch:-1})},e.prototype.setDateTime=function(t,e){var n=e.target.value;"remind_date"==t&&this.setState({remind_date:n}),"remind_time"==t&&this.setState({remind_time:n})},e.prototype.setRemind=function(t){this.setState({remind:t})},e.prototype.setTheme=function(t){this.setState({theme:t.val})},e.prototype.submit=function(){var t=s(s({},this.state),this.formPersonsData);delete t.themes,t.forReclamation?T50PubSub.send("reclamation_comment_modal_submit",t):T50PubSub.send("comment_modal_submit",t)},e.prototype.render=function(){var t=this;return a.h("form",{class:"form"},this.state.forReclamation?null:a.h("label",{class:"form__line"},a.h("div",{class:"form__label"},"Тема"),a.h(c.default,{items:this.state.themes,value:this.state.theme,onSelect:this.setTheme.bind(this),class:"js-select modal__select"})),a.h("div",{class:"form__line"},a.h("div",{class:"triple-group"},a.h("div",{class:"triple-group__item"},a.h(i.default,{checked:this.state.remind,text:"напомнить",onClick:this.setRemind.bind(this)})),a.h("div",{class:"triple-group__item"},a.h("div",{class:"form__field form__field_size-m_s form__field_type_inline"},a.h(l.default,{type:"date",value:this.state.remind_date,onChange:this.setDateTime.bind(this,"remind_date"),showIcon:!0,labelClass:"form__input-wrapper"}))),a.h("div",{class:"triple-group__item"},a.h(l.default,{type:"time",value:this.state.remind_time,onChange:this.setDateTime.bind(this,"remind_time"),labelClass:"form__field form__field_size-xs_s form__field_type_inline"})))),a.h(u.default,{onUpdate:function(e){return t.formPersonsData=e}}),a.h("div",{class:"form__controls form__controls_align_center modal__controls"},a.h("div",{class:"form__control modal__control"},a.h("button",{class:"button button_width_full",type:"button",onClick:this.submit.bind(this)},"Добавить комментарий"))))},e}(a.Component);e.default=p},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var s=n(0),a=function(t){function e(e){var n=t.call(this,e)||this;return n.state={checked:!1},n.propsToState(e),n}return o(e,t),e.prototype.componentWillReceiveProps=function(t){this.propsToState(t)},e.prototype.propsToState=function(t){var e=null!=t.checked&&t.checked;this.setState({checked:e})},e.prototype.onChange=function(){var t=!this.state.checked,e=!0;if(null!=this.props.onClick){var n=this.props.onClick(t);this.props.awaitConfirm&&!0!==n&&(e=!1)}this.setState({checked:e?t:this.state.checked})},e.prototype.render=function(){var t="checkbox_"+ ++e.checkboxCounter;return s.h("div",{class:"check-elem"},s.h("input",{type:"checkbox",id:t,class:"check-elem__input",checked:this.state.checked,onChange:this.onChange.bind(this)}),s.h("label",{for:t,class:"check-elem__label"},this.props.text))},e.checkboxCounter=0,e}(s.Component);e.default=a},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var s=arguments[e],a=0,i=s.length;a<i;a++,o++)r[o]=s[a];return r};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),i=function(t){function e(e){var n=t.call(this,e)||this;return n.state={value:e.value},n}return o(e,t),e.key=function(){return"select_key_"+ ++e.KEY_COUNTER},e.prototype.componentWillReceiveProps=function(t){this.setState({value:t.value})},e.prototype.componentDidMount=function(){this.el=$(this.ref),this.ref.onchange=this.select.bind(this)},e.prototype.componentWillUnmount=function(){$("select.select2-hidden-accessible").select2("destroy")},e.prototype.select=function(t){var e=t.target,n=this.getItems().find(function(t){return t.val==e.value});null!=n&&(this.setState({value:n.val}),null!=this.props.onSelect&&this.props.onSelect(n))},e.prototype.getItems=function(){var t,e=s(this.props.items),n=this.props.default;return null!=n&&(n.disabled=null==(t=n.disabled)||t,e.unshift(n)),e},e.prototype.getOptions=function(){var t=this;return this.getItems().map(function(e){var n,r=e.val==t.state.value,o=null!=(n=e.disabled)&&n;return a.h("option",{disabled:o,value:e.val,selected:r},e.title)})},e.prototype.render=function(){var t=this,e=0==this.props.items.length;return a.h("select",{disabled:e,ref:function(e){return t.ref=e},class:this.props.class,value:this.state.value},this.getOptions())},e.KEY_COUNTER=0,e}(a.Component);e.default=i},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var s=n(0),a=n(6),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.componentDidMount=function(){var t=this;"time"!=this.props.type?$(this.inputDate).datetimepicker({timepicker:!1,format:"d.m.Y",scrollMonth:!1,scrollInput:!1}).on("change",function(e){null!=t.props.onChange&&t.props.onChange(e)}):$(this.inpuTime).change(function(e){null!=t.props.onChange&&t.props.onChange(e)})},e.prototype.render=function(){var t=this;return"date"==this.props.type?s.h("label",{class:this.props.labelClass},s.h("input",{type:"text",value:this.props.value,class:"form__input",ref:function(e){return t.inputDate=e}}),this.props.showIcon?s.h(a.default,{name:"icon_calendar",class:"form__input-icon"}):null):s.h("label",{class:this.props.labelClass},s.h("input",{value:this.props.value,class:"form__input js-time",ref:function(e){return t.inpuTime=e}}))},e}(s.Component);e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0);e.default=function(t){return r.h("svg",{class:t.class},r.h("use",{xlinkHref:"/local/templates/main/assets/images/icon.svg#"+t.name}))}},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function a(t){try{c(r.next(t))}catch(t){s(t)}}function i(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,i)}c((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var n,r,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),c=n(8),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={open:!1,search:"",comment:"",managers:[],targetManagers:[]},e.launchCallback=!1,e}return o(e,t),e.prototype.componentDidMount=function(){var t=this;$(document).mouseup(function(e){var n=$(t.base);n.is(e.target)||0!==n.has(e.target).length||t.setState({open:!1})})},e.prototype.componentDidUpdate=function(){this.launchCallback&&(null!=this.props.onUpdate&&this.props.onUpdate({comment:this.state.comment,targetManagers:this.state.targetManagers.map(function(t){return t.id})}),this.launchCallback=!1)},e.prototype.open=function(){var t=this;this.setState({open:!0}),null!=this.searchInput&&setTimeout(function(){$(t.searchInput).focus()},200)},e.prototype.loadManagers=function(t){var e;return s(this,void 0,void 0,function(){var n,r;return a(this,function(o){switch(o.label){case 0:return(n=t.target.value).length<2?[2]:(this.setState({search:n}),[4,T50Ajax.postJson("common_ajax","load_managers",{name:n})]);case 1:return(r=o.sent()).result&&this.setState({managers:(e=r.data,null!=e?e:[])}),[2]}})})},e.prototype.selectManager=function(t,e){e.preventDefault();var n=this.state.targetManagers;n.find(function(e){return e.id==t.id})||(n.push(t),this.setState({targetManagers:n,open:!1,search:"",managers:[]}),this.launchCallback=!0)},e.prototype.removeManager=function(t){var e=this.state.targetManagers.filter(function(e){return e.id!=t.id});this.setState({targetManagers:e})},e.prototype.changeComment=function(t){var e=t.target,n=e.value;n=n.replace(e.dataset.managers,""),this.setState({comment:n}),this.launchCallback=!0},e.prototype.getManager=function(t){var e=t.name,n=new RegExp("("+this.state.search+")","ig");return e=e.replace(n,'<span class="persons-finder__marked">$1</span>'),i.h("li",{class:"persons-finder__item"},i.h("a",{href:"#",class:"persons-finder__link",dangerouslySetInnerHTML:{__html:e},onClick:this.selectManager.bind(this,t)}))},e.prototype.getTextarea=function(){var t=this.state.targetManagers.map(function(t){return t.name}).join(", ");t.length&&(t+=", ");var e=t+this.state.comment;return i.h("textarea",{class:"form__textarea form__textarea_type_ninja form__textarea_size_normal",onInput:this.changeComment.bind(this),"data-managers":t,value:e})},e.prototype.render=function(){var t=this;return i.h("label",{class:"form__line"},i.h("div",{class:"form__label"},"Комментарий"),i.h("div",{class:"form__wrapper"},this.getTextarea(),i.h("div",{class:"form__persons"},i.h("div",{class:"persons-finder "+(this.state.open?"persons-finder_state_open":"")},i.h("div",{class:"persons-finder__trigger",onClick:this.open.bind(this)},i.h(c.default,{class:"persons-finder__icon",name:"icon_account"})),i.h("div",{class:"persons-finder__panel"},i.h("div",{class:"persons-finder__content"},i.h("div",{class:"persons-finder__form"},i.h("form",{class:"form"},i.h("input",{type:"text",value:this.state.search,class:"form__input",onInput:this.loadManagers.bind(this),ref:function(e){return t.searchInput=e}}))),i.h("div",{class:"persons-finder__label"},"Люди"),i.h("ul",{class:"persons-finder__items"},this.state.managers.map(this.getManager.bind(this)))))))),i.h("ul",{class:"order_comment_target_managers"},this.state.targetManagers.map(function(e){return i.h("li",null,e.name," ",i.h("a",{class:"delete_link",onClick:t.removeManager.bind(t,e)}))})))},e}(i.Component);e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0);e.default=function(t){return r.h("svg",{class:t.class},r.h("use",{xlinkHref:"/local/templates/main/assets/images/icon.svg#"+t.name}))}}]);